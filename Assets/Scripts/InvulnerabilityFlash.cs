using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class InvulnerabilityFlash : MonoBehaviour {
	[SerializeField] float timeBetweenFlashes = 0.2f;
	MeshRenderer[] meshRenderers;
	float flashDuration;
    float startTime;

    void Start()
	{
		flashDuration = GetComponent<PlayerHealth>().invulnerabiltyTime;
		
		//Cache list of all meshrenderers
		meshRenderers = GetComponentsInChildren<MeshRenderer>();
	}

	public void Flash()
	{
		startTime = Time.time;
		StartCoroutine(FlashRoutine());
	}

	IEnumerator FlashRoutine()
	{
		while (Time.time - startTime < flashDuration)
		{
			yield return new WaitForSeconds(timeBetweenFlashes);
			//Do the flash
			foreach (var mr in meshRenderers)
			{
				mr.enabled = !mr.enabled;
			}
		}
		//Invulnerablility over, make visible again
		foreach (var mr in meshRenderers)
		{
			mr.enabled = true;
		}
	}
}
